<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Food Memories</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<style>
  
body{
  background: linear-gradient(135deg, rgba(43,16,85,0.95), rgba(28,5,34,0.95));
  color:white;
  padding:40px;
  min-height:100vh;
}

h2{
  text-align:center;
  margin-bottom:30px;
}

.memory-card{
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(20px);
  border-radius:20px;
  padding:20px;
  margin-bottom:25px;
  position:relative;
  box-shadow: 0 15px 40px rgba(0,0,0,0.3);
  transition: transform 0.3s ease;
}

.memory-card:hover{
  transform: scale(1.02);
}

.memory-img{
  width:100%;
  max-height:250px;
  object-fit:cover;
  border-radius:15px;
  margin-bottom:15px;
}

.delete-btn{
  position:absolute;
  top:15px;
  right:20px;
  color:#ff4d4d;
  font-size:1.3rem;
  cursor:pointer;
}

.search-box{
  max-width:400px;
  margin:0 auto 30px auto;
}

.note-text{
  font-style: italic;
  opacity:0.9;
}
</style>
</head>
<body>
{% include 'navbar.html' %}

<h2>üçΩÔ∏è My Food Memories</h2>

<div class="search-box">
  <input type="text" id="searchMemory" class="form-control" placeholder="Search memories...">
</div>

<div id="memoriesList"></div>

<script>
function loadMemories(){
  fetch("/get-memories")
  .then(res => res.json())
  .then(memories => {

    const list = document.getElementById("memoriesList");
    list.innerHTML = "";

    if(!memories || memories.length === 0){
      list.innerHTML = "<p class='text-center'>No memories yet üç≥</p>";
      return;
    }

    // Show latest first
    memories.slice().reverse().forEach((m,index) => {

      list.innerHTML += `
        <div class="memory-card">
          <i class="bi bi-trash delete-btn" onclick="deleteMemory(${index})"></i>

          ${m.image ? `<img src="${m.image}" class="memory-img">` : ""}

          <h4>${m.name}</h4>
          <p>üî• ${m.calories} kcal</p>
          <p>üßÇ ${m.ingredients ? m.ingredients.join(", ") : ""}</p>

          ${m.note ? `<p class="note-text">üìù ${m.note}</p>` : ""}

          <small>üìÖ ${m.cooked_at || ""}</small>
        </div>
      `;
    });
  });
}

function deleteMemory(index){
  fetch("/delete-memory",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({index:index})
  }).then(()=>loadMemories());
}

// üîé Search Feature
document.getElementById("searchMemory").addEventListener("input", function(){
  const term = this.value.toLowerCase();
  document.querySelectorAll(".memory-card").forEach(card => {
    card.style.display = card.innerText.toLowerCase().includes(term)
      ? "block"
      : "none";
  });
});

loadMemories();

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>